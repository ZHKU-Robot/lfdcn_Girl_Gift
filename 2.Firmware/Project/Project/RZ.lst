C51 COMPILER V9.60.0.0   RZ                                                                12/06/2020 14:28:35 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE RZ
OBJECT MODULE PLACED IN .\RZ.obj
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE ..\User\RZ\RZ.C LARGE OPTIMIZE(8,SPEED) BROWSE NOAREGS INCDIR(..\Public;..
                    -\User\GPIO;..\User\PWM;..\User\Timer;..\User\ADC;..\User\Compare;..\User\DataFlash;..\User\IAP;..\User\SPI;..\User\Touch
                    -Key;..\User\USB\USB_LIB;..\User\IIC;..\User\UART;..\User\Timer;..\User\RZ) DEBUG OBJECTEXTEND PRINT(.\RZ.lst) OBJECT(.\R
                    -Z.obj)

line level    source

   1          #include "RZ.H"
   2          #include <CH552.H>
   3          #include <stdio.h>
   4          #include "Debug.H"
   5          #include <intrins.h>
   6          
   7          #pragma  NOAREGS
   8          
   9          sbit DIN2_RGB = P1^5;
  10          
  11          /*
  12          子程序名称:RZ_SendByte(UINT8 *ptr)
  13          功能：发送一个像素点的24bit数据
  14          参数：接收的参数是一个指针，此函数会将此指针指向的地址的连续的三个Byte的
             -数据发送
  15          说明：在主函数中直接调用此函数时，在整个帧发送开始前需要先执行 ResetDataFlo
             -w()
  16          数据是按归零码的方式发送，速率为800KBPS
  17          */
  18          void RZ_SendByte(UINT8 *ptr)
  19          {
  20   1              UINT8 i,j;
  21   1              UINT8 temp;
  22   1              
  23   1              for(j=0;j<3;j++)
  24   1              {
  25   2                      temp=ptr[j];
  26   2                      for(i=0;i<8;i++)
  27   2                      {
  28   3                              if(temp&0x80)            //从高位开始发送
  29   3                              {
  30   4                                      DIN2_RGB = 1;
  31   4      //                              delay_H();
  32   4                                      DIN2_RGB = 0;
  33   4      //                              delay_L();
  34   4                              }
  35   3                              else                            //发送“0”码
  36   3                              {
  37   4                                      DIN2_RGB = 1;
  38   4      //                              delay_H();
  39   4                                      DIN2_RGB = 0;
  40   4      //                              delay_L();
  41   4                              }
  42   3                              temp=(temp<<1);          //左移位
  43   3                      }
  44   2              }
  45   1      }
  46          
  47          void ResetDataFlow(void)
  48          {
  49   1              DIN2_RGB = 0;
  50   1              mDelayuS(200);
C51 COMPILER V9.60.0.0   RZ                                                                12/06/2020 14:28:35 PAGE 2   

  51   1      }
  52          
  53          void delay_L(void)
  54          {
  55   1              _nop_();
  56   1      }
  57          
  58          void delay_H(void)
  59          {
  60   1          _nop_();
  61   1      }
  62          
  63          /*发送24位字符（包含RGB信息各8位）*/
  64          void Send_24bits(struct My_24bits RGB_VAL)
  65          {
  66   1          UINT8 i;
  67   1          for(i=0; i<8; i++)
  68   1          {
  69   2              Send_A_bit(RGB_VAL.G_VAL>>(7-i)&0x01);//注意是从高位先发
  70   2          }
  71   1          for(i=8; i<16; i++)
  72   1          {
  73   2              Send_A_bit(RGB_VAL.R_VAL>>(15-i)&0x01);
  74   2          }
  75   1          for(i=16; i<24; i++)
  76   1          {
  77   2              Send_A_bit(RGB_VAL.B_VAL>>(23-i)&0x01);
  78   2          }
  79   1      }
  80          
  81          void Send_A_bit(UINT8 VAL)
  82          {
  83   1          if (VAL==1)
  84   1          {
  85   2              DIN2_RGB=1;
  86   2              _nop_();//两个nop，大概是0.5us,经测试，发送完1后的延时最重要
  87   2              _nop_();
  88   2                      _nop_();
  89   2              DIN2_RGB=0;
  90   2          }
  91   1          else
  92   1          {
  93   2              DIN2_RGB=1;
  94   2              _nop_(); //一个nop,大概是0.25us
  95   2              DIN2_RGB=0;
  96   2          }
  97   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    260    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
